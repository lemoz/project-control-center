services:
  api:
    build:
      context: .
      dockerfile: .docker/Dockerfile.pcc-api
    network_mode: "host"
    restart: unless-stopped
    env_file:
      - .env
    environment:
      NODE_ENV: production
      CONTROL_CENTER_PORT: 5010
      CONTROL_CENTER_DB_PATH: /repos/pcc/control-center-test.db
      CONTROL_CENTER_SCAN_ROOTS: /repos
    volumes:
      - ./:/repos/pcc
      - /var/run/docker.sock:/var/run/docker.sock
      - ${HOME}/.codex:/root/.codex

  ui:
    build:
      context: .
      dockerfile: .docker/Dockerfile.pcc-ui
      args:
        NEXT_PUBLIC_API_BASE_URL: http://localhost:5010
    network_mode: "host"
    restart: unless-stopped
    environment:
      NODE_ENV: production
      PORT: 5020
      NEXT_PUBLIC_API_BASE_URL: http://localhost:5010
      CONTROL_CENTER_INTERNAL_API_BASE_URL: http://localhost:5010
    depends_on:
      - api
